<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>OpenAI Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>

  <body class="bg-green-100 min-h-screen flex items-center justify-center p-4">
    <div
      class="bg-white w-full max-w-2xl h-[85vh] rounded-2xl shadow-2xl flex flex-col"
    >
      <!-- Header -->
      <div class="p-4 border-b">
        <h1 class="text-2xl font-bold text-green-700">ü§ñ OpenAI Chat</h1>
        <p class="text-sm text-gray-500">
          Ask anything and get smart responses
        </p>
      </div>

      <!-- Chat Area -->
      <div id="chatContainer" class="flex-1 p-4 space-y-4 overflow-y-auto">
        <div class="bg-green-50 p-3 rounded-xl text-green-800 w-fit">
          üëã Hi! Ask me something.
        </div>
      </div>

      <!-- Input -->
      <div class="p-4 border-t flex gap-2">
        <textarea
          id="prompt"
          rows="2"
          placeholder="Type your question..."
          class="flex-1 border rounded-xl p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
        ></textarea>
        <button
          id="askBtn"
          class="bg-green-600 text-white px-5 rounded-xl hover:bg-green-700 transition"
        >
          Ask
        </button>
      </div>
    </div>

    <script>
      const btn = document.getElementById("askBtn");
      const promptInput = document.getElementById("prompt");
      const chatContainer = document.getElementById("chatContainer");

      function addMessage(text, sender) {
        const div = document.createElement("div");
        div.className =
          "max-w-[80%] p-3 rounded-xl whitespace-pre-wrap break-words";

        if (sender === "user") {
          div.classList.add(
            "bg-green-600",
            "text-white",
            "self-end",
            "ml-auto"
          );
        } else {
          div.classList.add("bg-green-50", "text-green-900");
        }

        // Beautify numbered lists
        const formatted = text.replace(
          /^(\d+)\.\s(.*)$/gm,
          "<strong>$1.</strong> $2"
        );

        div.innerHTML = formatted;
        chatContainer.appendChild(div);
        chatContainer.scrollTop = chatContainer.scrollHeight;
      }

      btn.addEventListener("click", async () => {
        const prompt = promptInput.value.trim();
        if (!prompt) return;

        addMessage(prompt, "user");
        promptInput.value = "";
        btn.disabled = true;
        btn.textContent = "Thinking...";

        try {
          const res = await fetch("http://localhost:4002/api/openai", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt }),
          });

          const data = await res.json();
          if (data.ok) {
            addMessage(data.text, "ai");
          } else {
            addMessage("‚ùå " + data.error, "ai");
          }
        } catch (err) {
          addMessage("‚ö†Ô∏è " + err.message, "ai");
        }

        btn.disabled = false;
        btn.textContent = "Ask";
      });
    </script>
  </body>
</html>
