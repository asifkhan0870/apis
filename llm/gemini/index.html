<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gemini UI</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="flex items-center justify-center min-h-screen p-4">
    <div
      class="bg-white shadow-2xl rounded-2xl w-full max-w-xl flex flex-col h-[80vh]"
    >
      <h1 class="text-2xl font-bold p-4 text-green-800 border-b">
        Gemini Chat Interface
      </h1>

      <!-- Conversation area -->
      <div id="chatContainer" class="flex-1 p-4 overflow-y-auto space-y-4">
        <!-- Messages will appear here -->
      </div>

      <!-- Input area -->
      <div class="p-4 border-t flex gap-2">
        <textarea
          id="prompt"
          class="flex-1 border rounded-md p-3 focus:outline-none focus:ring-2 focus:ring-green-500"
          rows="2"
          placeholder="Type your prompt..."
        ></textarea>
        <button
          id="askBtn"
          class="bg-green-600 text-white px-4 py-2 rounded-xl hover:bg-green-700 transition"
        >
          Ask
        </button>
      </div>
    </div>

    <script>
      const btn = document.getElementById("askBtn");
      const promptInput = document.getElementById("prompt");
      const chatContainer = document.getElementById("chatContainer");

      const addMessage = (text, sender) => {
        const msgDiv = document.createElement("div");
        msgDiv.classList.add(
          "max-w-[75%]",
          "p-3",
          "rounded-xl",
          "break-words",
          "whitespace-pre-wrap"
        ); // âœ… preserve line breaks
        msgDiv.innerHTML = text; // use innerHTML if you want bold or <br> formatting

        if (sender === "user") {
          msgDiv.classList.add(
            "self-end",
            "bg-green-600",
            "text-white",
            "rounded-br-none"
          );
        } else {
          msgDiv.classList.add(
            "self-start",
            "bg-green-50",
            "text-green-900",
            "rounded-bl-none"
          );
        }

        chatContainer.appendChild(msgDiv);
        chatContainer.scrollTop = chatContainer.scrollHeight; // auto scroll
      };

      btn.addEventListener("click", async () => {
        const prompt = promptInput.value.trim();
        if (!prompt) return;

        addMessage(prompt, "user"); // show user message
        promptInput.value = "";
        btn.disabled = true;
        btn.textContent = "Thinking...";

        try {
          const res = await fetch("http://localhost:4001/api/gemini", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ prompt }),
          });

          const data = await res.json();
          if (data.ok) {
            // Convert numbered list format to HTML for better display
            const formattedText = data.text.replace(
              /^(\d+)\.\s(.*)$/gm,
              "<strong>$1. $2</strong>"
            ); // bold the numbers and titles
            addMessage(formattedText, "ai");
          } else {
            addMessage("Error: " + data.error, "ai");
          }
        } catch (err) {
          addMessage("Error: " + err.message, "ai");
        }

        btn.disabled = false;
        btn.textContent = "Ask";
      });
    </script>
  </body>
</html>
