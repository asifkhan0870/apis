<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Anthropic (Claude) â€“ LLM Tester</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background: #faf9f7;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Helvetica, Arial, sans-serif;
        color: #1f1f1f;
      }

      .card {
        border-radius: 12px;
        border: none;
        box-shadow: none;
        background: #ffffff;
      }

      .claude-answer {
        max-width: 720px;
        margin: 0 auto;
        font-size: 15px;
        line-height: 1.55;
      }

      .claude-answer p {
        margin: 0 0 10px 0;
      }

      .claude-answer strong {
        font-weight: 600;
      }

      .claude-answer ul {
        margin: 6px 0 0 18px;
        padding: 0;
      }

      .claude-answer li {
        margin-bottom: 4px;
      }

      .json-box {
        background: #0b1220;
        color: #9ef01a;
        font-size: 13px;
        padding: 14px;
        border-radius: 8px;
        max-height: 260px;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <div class="row justify-content-center">
        <div class="col-lg-8">
          <div class="card p-4">
            <h3 class="mb-3 text-center">
              ðŸ¤– Anthropic (Claude) â€“ Prompt Tester
            </h3>

            <div class="mb-3">
              <label class="form-label">Prompt</label>
              <textarea
                id="prompt"
                class="form-control"
                rows="4"
                placeholder="Search whatever you want "
              ></textarea>
            </div>

            <div class="d-grid">
              <button class="btn btn-primary" onclick="sendPrompt()">
                Search
              </button>
            </div>
          </div>

          <!-- Result -->

          <div class="card p-4 mt-4 d-none" id="resultCard">
            <h5 class="mb-3">âœ… Claude Response</h5>

            <!-- Rendered Output -->
            <div id="renderedResult"></div>

            <h6 class="mt-4">ðŸ“„ Raw JSON</h6>
            <pre id="jsonResult"></pre>
          </div>

          <!-- Error -->
          <div class="alert alert-danger mt-4 d-none" id="errorBox"></div>
        </div>
      </div>
    </div>

    <script>
      async function sendPrompt() {
        const prompt = document.getElementById("prompt").value;
        const resultCard = document.getElementById("resultCard");
        const errorBox = document.getElementById("errorBox");
        const renderedResult = document.getElementById("renderedResult");

        resultCard.classList.add("d-none");
        errorBox.classList.add("d-none");
        renderedResult.innerHTML = "";

        if (!prompt.trim()) {
          errorBox.innerText = "Prompt is required";
          errorBox.classList.remove("d-none");
          return;
        }

        try {
          const response = await fetch(
            "http://localhost:4000/query-anthropic",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ prompt }),
            }
          );

          const data = await response.json();

          if (!response.ok || !data.result?.ok) {
            throw new Error(JSON.stringify(data, null, 2));
          }

          renderClaudeLike(data.result.text);

          document.getElementById("jsonResult").innerText = JSON.stringify(
            data,
            null,
            2
          );

          resultCard.classList.remove("d-none");
        } catch (err) {
          errorBox.innerText = "Error:\n" + err.message;
          errorBox.classList.remove("d-none");
        }
      }

      function renderClaudeLike(text) {
        const container = document.getElementById("renderedResult");

        const wrapper = document.createElement("div");
        wrapper.className = "claude-response";

        const lines = text.split("\n");

        let ul = null;

        lines.forEach((line) => {
          line = line.trim();
          if (!line) {
            ul = null;
            return;
          }

          // Section headers
          if (line.endsWith(":")) {
            const section = document.createElement("div");
            section.className = "claude-section";
            section.innerHTML = `<strong>${line}</strong>`;
            wrapper.appendChild(section);
            ul = null;
            return;
          }

          // Bullet points
          if (line.startsWith("-")) {
            if (!ul) {
              ul = document.createElement("ul");
              wrapper.appendChild(ul);
            }
            ul.innerHTML += `<li>${line.replace("-", "").trim()}</li>`;
            return;
          }

          // Normal paragraph
          const p = document.createElement("p");
          p.textContent = line;
          wrapper.appendChild(p);
          ul = null;
        });

        container.appendChild(wrapper);
      }
    </script>
  </body>
</html>
